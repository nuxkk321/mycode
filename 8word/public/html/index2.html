<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title> </title>
	<link rel="stylesheet" type="text/css" href="/public/layui/css/layui.css" />
    <script type="text/javascript" src="/public/layui/layui.all.js"></script>
    <style type="text/css">
        body, html {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            min-width: 500px;
        }

        body {
            background-color: black;
            font-size: 10pt;
            text-shadow: 0px 1px 0px rgb(40, 40, 40);
        }

        a { color: #ccc; text-decoration: none; }
        a:hover { color: #FF3B03; }
		
		
		#config_box {
			float: left;
			z-index: 10;
			position: relative;
			background-color: rgba(30, 30, 30, 0.6);
			font-family: sans-serif;
			padding: 15px;
			margin: 0;
			border: 2px solid rgba(20, 20, 20, 0.6);
			color: #FF3B03;
			text-shadow: 0px 1px 0px rgb(40, 40, 40);
			width: 250px;
			user-select: none;
			-moz-user-select: none;
			-khtml-user-select: none;
			-webkit-user-select: none;
			-o-user-select: none;
		}
		#display_box {
			background-color: #eee;
			margin-left: 290px;
			position: relative;
			width: auto;
			height: auto;
			overflow: hidden;
		}
		#display_box .box_block{
            width: 100%
        }
		.ex_info_cell{
			width:70px;
			text-align:center;
			height:20px;
			line-height:20px;
			vertical-align:top;
		}
		.border_span{
            display: inline-block;
            border: 1px solid #000;
        }
		
		.tips_1{background:red}
		.tips_2{background:#ff8b00}
		.tips_3{background:yellow}
		
        .c_2_1{width: 50px}
        .c_2_2,.c_2_4,.c_2_6,.c_2_8{
            width: 120px;
        }
        .c_2_3,.c_2_5,.c_2_7{
            width: 100px;
        }
		
		.simple_info .c_3,.simple_info .c_5,.simple_info .c_6,.simple_info .c_7,
		.simple_info .detail_cell{
			display:none;
		}
		
		.simple_info .c_2_2,.simple_info .c_2_4,.simple_info .c_2_6,.simple_info .c_2_8{
			width:20px;
		}
    </style>
</head>
<body >
    <div id="config_box">
        <form id="settingsForm"  >
            <table>
                <thead>
                     <tr>
                        <th style="width:50px">选择时间</td>
                        <th style="width:80px">
                            <input type='text' id='input_date' />
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>天干:</td>
                        <td>
                            <select class="select_stems" name="s1" id="年干">
                            </select>
                            <select class="select_stems" name="s2" id="月干">
                            </select>
                            <select class="select_stems" name="s3" id="日干">
                            </select>
                            <select class="select_stems" name="s4" id="时干">
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>地支:</td>
                        <td>
                            <select class="select_branches" name="b1" id="年支">
                            </select>
                            <select class="select_branches" name="b2" id="月支">
                            </select>
                            <select class="select_branches" name="b3" id="日支">
                            </select>
                            <select class="select_branches" name="b4" id="时支">
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>开始大运:</td>
                        <td>
                            <select class="select_stems" name="s5" id="大运干" data-target="#大运支">
                            </select>
                            <select class="select_branches" name="b5" id="大运支">
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">&nbsp;</td>
                    </tr>
                    <tr>
                        <td  >
                            <input type="button" id="prev_word_d" value="上一天" />
                        </td>
                        <td  >
                            <input type="button" id="next_word_d" value="下一天" />
                        </td>
                    </tr>
                    <tr>
                        <td  >
                            <input type="button" id="prev_word_t" value="上一时辰" />
                        </td>
                        <td  >
                            <input type="button" id="next_word_t" value="下一时辰" />
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">&nbsp;</td>
                    </tr>
                    <tr>
                        <td >
                            <input type="button" id="reset_today" value="reset_today" />
                        </td>
                        <td >
                            <input type="button" id="calc_now" value="calc_now" />
                        </td>
                    </tr>
					 <tr>
                        <td>
                            最小时间段
                        </td>
                        <td>
							<select id="calc_length">
                                <option value='h' selected="selected">时</option>
                                <option value='d' >日</option>
                                <option value='m'>月</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            计算时长
                        </td>
                        <td>
                            <input class="textInput" size="4" type="text" id="calc_next_length" value="7" />
                        </td>
                    </tr>
                    <tr>
                        <td>比较开始时间</td>
                        <td>
                            <input type='text' id='start_date' />
                            <input type="button" id="calc_next" value="calc_next" />
                        </td>
                    </tr>
					<tr>
                        <td>
							<label>
                                精简模式:
                                <input type="checkbox" id="calc_simple_info" value="1" />
							</label>
						</td>
                         
                    </tr>
                </tbody>

            </table>
			<div >
				<input type="text" id="random_str" value="" />
			</div>
        </form>
    </div>

    <div id="display_box">
        <table class="box_block" style="width:1300px">
            <tr>
                <td style="width:100%" >
                    <div id="word_info_box_top" style="height: 1000px;overflow: scroll;">

                    </div>
                </td>
                <td >
                    
                </td>
            </tr>
			<tr>
				<td style="width:100%"  ></td><td></td>
			</tr>
        </table>
        <table class="box_block" style="display: none">
            <tr>
                <td style="width:100px;position: relative">
                    <div class='prev_btn'>
                        <<<
                    </div>
                </td>
                <td style="width:600px">
                    <div id="main" style="width:100%;min-height: 2500px">

                    </div>
                    <div id="branche_box" style="position: relative">
                    </div>
                </td>
            </tr>
        </table>
		
    </div>

    <div id="word_info_box_sec" style="display: none">
        <table border="0" cellpadding="0" cellspacing="1" >
            <tr>
                <td >
                    <table border="1" cellpadding="0" cellspacing="0" class="zhu_info_0">

                    </table>
                </td>
                <td >
                    <table border="1" cellpadding="0" cellspacing="0" class="zhu_info_1">

                    </table>
                </td>
                <td >
                    <table border="1" cellpadding="0" cellspacing="0" class="zhu_info_2">

                    </table>
                </td>
                <td >
                    <table border="1" cellpadding="0" cellspacing="0" class="zhu_info_3">

                    </table>
                </td>
            </tr>
        </table>
    </div>

</body>


<script type="text/javascript" src='/public/jquery-1.10.2.min.js'></script> 
<script type="text/javascript" src='/public/echarts.min.js'></script>
<script type="text/javascript" src='/public/8word_calc.js'></script>
<script>
    var calc_param={};
	//生成随机字符串
	function random_str(e) {  
	  if(!e) e=10;
	  var t = "abcdefhijkmnprstwxyz2345678";
	  t+='$%^#@';
	  //t+='ABCDEFGHJKMNPQRSTWXYZ';
	  a = t.length,
	  n = "";
	  for (i = 0; i < e; i++) n += t.charAt(Math.floor(Math.random() * a));
	  return n
	}
	$(function(){
		$('#random_str').val(random_str());
	});
	
    function igetv(obj,index,start){
        if(typeof(start)=='undefined') start=0;
        var c=start;
        for(var i in obj){
            if(c==index) return obj[i];
            c++
        }
    }
    function obj_length(obj){
        if(!obj) return 0;
        var c=0;
        for(var k in obj) c++;

        return c;
    }
    function arraySelect(keys,input){
        if(typeof(keys)=='string') keys=keys.split(',');
        var re={};
        $.each(keys,function(k,v){
            if(typeof(v)=='string'){
                v=v.split('|');
            }
            re[v[1]?v[1]:v[0]]=input[v[0]];
        });
        return re;
    }
    function updateHashTag(){
        var data=$('#settingsForm :input').serializeArray();
//            location.hash =
//            's1=' + zoom + '&' +
//            'b1=' + lookAt + '&' +
//            's2=' + iterations + '&' +
//            'b2=' + samples + '&' +
//            's3=' + radius + '&' +
//            'b3=' + samples + '&' +
//            's4=' + radius + '&' +
//            'b4=' + scheme;

    }

	 /*选择今天*/
	function move_date(type){
		var date=$('#input_date').val();
		if(!date || !type){
			date=new Date();
			date=date.getTime();
		}
		date=sb_calc_tools.get_date_split_arr(date);

		//减去 时辰 的偏移量 一个时辰=7200秒
		date=date[4]-type*7200*1000;
		//再次计算
		date=sb_calc_tools.get_date_split_arr(date);
		//自动填入日期选择框
		$('#input_date').val(date[5]);
		reset_8w_time_input(date[5],function(){
            setTimeout(function(){
                $('#calc_now').click();
            },120);

        });


	}
	
	/*加载输入时间对应的 天干地支*/
    function reset_8w_time_input(timestr,cb){
        function next(date_word){
            $.each(['干','支'],function(k1,v1){
                $.each(['年','月','日','时'],function(k,time_word){
                    var val=date_word[time_word+v1];
                    var select=$('#'+time_word+v1);

                    var tofind=$('option[value="'+val+'"]',select);

                    if(tofind.length>0){
                        tofind.prop('selected',true);
                    }
                    if(k1==0) select.change();
                });
            });
            if(cb) cb();
        }
        if(timestr && typeof(timestr)=='object'){
            next(timestr);
        }else{
            sb_calc_tools.get_date_8w_info(timestr,function(err,date_word){
                next(date_word);
            });
        }
    }

    function update_calc_param(){
        calc_param={
            score:{
                k_zhengguan:$('#calc_k_zhengguan_percent').val(),
                k_qisha:$('#calc_k_qisha_percent').val(),

                s_zhengyin:$('#calc_s_zhengyin_percent').val(),
                s_pianyin:$('#calc_s_pianyin_percent').val(),
                chongtg:$('#calc_chongtg_percent').val(),
                tgh:$('#calc_tgh_percent').val(),

                bqtg:$('#calc_bqtg_percent').val(),

                chongdz:$('#calc_chongdz_percent').val(),
                xing:$('#calc_xing_percent').val(),
                hai:$('#calc_hai_percent').val(),
                lh:$('#calc_lh_percent').val(),
                banhe:$('#calc_banhe_percent').val(),
                sanhe:$('#calc_sanhe_percent').val(),
                sanhui:$('#calc_sanhui_percent').val()

            },
            calc_dynamic_effect:$('#calc_dynamic_effect').is(':checked'),
            show_st_and_br:$('#show_st_and_br').is(':checked'),
			st_br_show_type:$('input[name="st_br_show_type"]:checked').val(),
            compare_by_input:$('#compare_by_input').is(':checked'),
            only_show_compare_relation:$('#only_show_compare_relation').is(':checked')
        };
    }
	 
    function reload_word_info_table(id,org_word_info,date_word,time_str){
        var winfo_box=$('#'+id);
        if(winfo_box.length==0){
            /*初始化详细信息表格*/
            var word_info_table_str=
                '<table border="1" cellpadding="0" cellspacing="0" id="'+id+'" style="width:100%">' +
                    '<tr class="c_1">' +
                        '<td class="word_info_cell c_1_1" colspan="4"></td>' +
                        '<td class="word_info_cell c_1_2" colspan="3"></td>' +
                    '</tr>';

            for(var i=2;i<10;i++){
                word_info_table_str+=`<tr class="c_${i}">`;
                for(var k=1;k<10;k++){
					var fix=(k==3 || k==5 || k==7)?'detail_cell':'';
                    word_info_table_str+=`<td class="word_info_cell c_${i}_${k} ${fix}"></td>`;
                }
                word_info_table_str+='</tr>';
            }
            word_info_table_str+='</table>';
            winfo_box=$(word_info_table_str);
            $('#word_info_box_top').append(winfo_box);
        }

        $('.word_info_cell',winfo_box).html('');

        if(!org_word_info){
            org_word_info={};
            var t_arr_tmp=['年','月','日','时','大运'];
            $.each(t_arr_tmp,function(k,v){
                org_word_info[v+'干']=$('#'+v+'干').val();
                org_word_info[v+'支']=$('#'+v+'支').val();
            });
        }

        if(time_str){
            $('.c_1_1',winfo_box).text(time_str);
        }

        var word_info=sb_calc_tools.parse_all(org_word_info,date_word,calc_param);
        word_info=word_info[0];
//        console.log('综合计算结果:',word_info);

		/* 创建一个表示 五行和阴阳的小方块*/
		function build_5e_block(_5e_info){
			return 
			'<span class="e5label_'+_5e_info[0]+'">'+
				_5e_info[1]+
			'</span>';
		}
        
        /*八字天干*/
        function tg_info(part){
            return '';
        }
        function tg_gx(rela,change_val){
            var re='';
            if(rela.冲){
                re+='<div>---相冲---</div>';
            }
            if(rela.合){
                re+='<div>---相合,化'+rela.合+'---</div>';
            }

            var diff=rela.五行关系;
            if(diff[0]>0){
                re+='<div>'+(change_val || '')+' →</div>';
                if(diff[2]){
                    re+='<div>'+diff[1]+'→</div>';
                }else{
                    re+='<div>←'+diff[1]+'</div>';
                }
            }
            return re;
        }
        
		
		
//		$('.c_1_1',winfo_box).html(' ');
//		$('.c_1_2',winfo_box).html(tg_info('年'));
//
//        $('.c_1_4',winfo_box).html(tg_info('月'));
//
//        $('.c_1_6',winfo_box).html(tg_info('日'));
//
//        $('.c_1_8',winfo_box).html(tg_info('时'));
//		$('.c_1_9',winfo_box).html(`
//		<div class='next_btn' style="width:50px;position: relative">
//			>>>
//		</div>
//		<div class="summary_text"></div>
//		`);



		/* 十神~天干 */
        function build_ss_box(part){
            var num=t_arr_key[part];
            var ss=word_info.日干命局十神[num][0];
            if(part=='日') ss='日主';
            var str='<table style="width:auto;margin:auto" border="1">';
            str+=
                '<tr>'+
                '<td style="width:30px;text-align:center;">'+(word_info[part+'干'] || '')+
//                '<span class="e5label_'+e5info[0]+'">'+e5info[1]+'</span>'+
                '</td >' +
                '<td class="detail_cell" style="width:50px">'+
                ss+
//                '('+info[part+'支'+qi_name].命局透出.length+')'+
                '</td>'+
                '</tr>';
            str+='</table>';
            return str;
        }
        $('.c_2_1',winfo_box).html('天干');
        $('.c_2_2',winfo_box).html(build_ss_box('年'));
		$('.c_2_3',winfo_box).html(tg_gx(word_info.年干月干,word_info.年干月干变化值));
        $('.c_2_4',winfo_box).html(build_ss_box('月'));
		$('.c_2_5',winfo_box).html(tg_gx(word_info.月干日干,word_info.月干日干变化值));
        $('.c_2_6',winfo_box).html(build_ss_box('日'));
		$('.c_2_7',winfo_box).html(tg_gx(word_info.日干时干,word_info.日干时干变化值));
        $('.c_2_8',winfo_box).html(build_ss_box('时'));
		
		
		
		function concat_ex_info_str(info_arr,str,tis_lv){
			if(!tis_lv) tis_lv=0;
			var tis_lv_str='tips_'+tis_lv;
			
			if(!info_arr){
				str='';
				tis_lv_str='';
			}
			
			return '<div class="ex_info_cell border_span '+tis_lv_str+'">'+str+'</div>';
		}
		
		var st_ex_info='';
		st_ex_info+=concat_ex_info_str(word_info['年干日干'].冲,'年干冲日干',1);
		st_ex_info+=concat_ex_info_str(word_info['月干日干'].冲,'月干冲日干',2);
		
		st_ex_info+=concat_ex_info_str(word_info['年干时干'].冲,'年干冲时干',3);
		st_ex_info+=concat_ex_info_str(word_info['月干时干'].冲,'月干冲时干',3);
		st_ex_info+=concat_ex_info_str(word_info['日干时干'].冲,'日干冲时干',3);
		
	
		
		$('.c_2_9',winfo_box).html(st_ex_info);
		
        /*干支*/
        function gz_rela(info){
            if(!info[0]) return '';
            var ht='<div>'+info[0]+'</div>';
            if(info[1]){
                ht+='<div>↓</div>';
            }else{
                ht='<div>↑</div>'+ht;
            }
            return ht;
        }

        $('.c_3_2',winfo_box).html(gz_rela(word_info.年干支关系)+
			'<div>↑</div><div>'+word_info.年干命局十二长生[0]+'</div>'
		);

        $('.c_3_4',winfo_box).html(gz_rela(word_info.月干支关系)+
			'<div>↑</div><div>'+word_info.月干命局十二长生[1]+'</div>'
		);
		
        $('.c_3_5',winfo_box).html('<div>↗</div><div>'+word_info.日干命局十二长生[1]+'</div>');

        $('.c_3_6',winfo_box).html(gz_rela(word_info.日干支关系)+
			'<div>↑</div><div>'+word_info.日干命局十二长生[2]+'</div>'
		);

        $('.c_3_8',winfo_box).html(gz_rela(word_info.时干支关系)+
			'<div>↑</div><div>'+word_info.时干命局十二长生[3]+'</div>'
		);


        /*八字地支*/
        function build_br_rela(rela){
            var re='';
            if(rela.冲){
                re+='<div>---相冲---</div>';
            }
            if(rela.刑){
                re+='<div>---'+rela.刑+'---</div>';
            }
            if(rela.害){
                re+='<div>---相害---</div>';
            }
            if(rela.六合){
                re+='<div>---六合,化'+rela.六合+'---</div>';
            }
            if(rela.半合){
                re+='<div>-半合,缺'+rela.半合[1]+',化'+rela.半合[0]+'-</div>';
            }
            if(rela.暗拱){
                re+='<div>暗拱:'+rela.暗拱[1]+''+rela.暗拱[0]+'</div>';
            }
            if(rela.暗会){
                re+='<div>暗会:'+rela.暗会[0]+' 缺:'+rela.暗会[1]+'</div>';
            }
            var diff=rela.五行关系;
			return re;
			
			
            if(diff[0]>0){
                if(diff[2]){
                    re+='<div>'+diff[1]+'→</div>';
                }else{
                    re+='<div>←'+diff[1]+'</div>';
                }
            }
            
        }
        function br_info(part){
            var e5info=word_info[part+'支五行'];
            var str='';

            var re=
            '<div style="margin:auto;padding:2px;width: 40px;border:solid 1px #000;border-radius: 4px;">' +
                '<table style="width:auto;margin:auto" border="0">' +
                    '<tr>' +
                        '<td >' + word_info[part+'支']+
                            '<span class="dis_ib e5label_'+e5info[0]+' detail_cell" style="margin-left:3px">('+e5info[1]+')</span>'+
                        '</td>'+
                    '</tr>' +
                '</table>' +
            '</div>' ;
            return re;
        }
        $('.c_4_1',winfo_box).html('地支');
        $('.c_4_2',winfo_box).html(br_info('年'));
        $('.c_4_3',winfo_box).html(build_br_rela(word_info.年支月支));
        $('.c_4_4',winfo_box).html(br_info('月'));
        $('.c_4_5',winfo_box).html(build_br_rela(word_info.月支日支));
        $('.c_4_6',winfo_box).html(br_info('日'));
        $('.c_4_7',winfo_box).html(build_br_rela(word_info.日支时支));
        $('.c_4_8',winfo_box).html(br_info('时'));

        var other='';
		
		var br_ex_info='';
	 
		$.each(word_info.地支三合,function(k,v){
            br_ex_info+='<div>'+v[1].join('')+' 三合 '+v[0]+'局;</div>';
        });
        if(word_info.地支三会){
            br_ex_info+='<div>'+word_info.地支三会[2]+' 三会 '+word_info.地支三会[0]+'局;</div>';
        }
		
		br_ex_info+=concat_ex_info_str(word_info['年支日支'].冲,'岁破',1);
		br_ex_info+=concat_ex_info_str(word_info['月支日支'].冲,'月破',2);
		
		br_ex_info+=concat_ex_info_str(word_info['年支时支'].冲,'年支冲时支',3);
		br_ex_info+=concat_ex_info_str(word_info['月支时支'].冲,'月支冲时支',3);
		br_ex_info+=concat_ex_info_str(word_info['日支时支'].冲,'日支冲时支',3);
		
	
		
		


        $('.c_4_9',winfo_box).html(br_ex_info);
		
		

        /*地支藏干*/
        $('.c_5_1',winfo_box).html(
            '<table>' +
                '<tr>' +
                    '<td>本气:</td>' +
                '</tr>' +
                '<tr>' +
                    '<td>中气:</td>' +
                '</tr>' +
                '<tr>' +
                    '<td>余气:</td>' +
                '</tr>' +
            '</table>'
        );
        function build_cg_box(info,part){
            var str='<table style="width:auto;margin:auto" border="1">';
            var part_pos_num=t_arr_key[part];

            $.each(q_arr,function(k2,qi_name) {
                var cg_info=info[part+'支'+qi_name];
                var e5info=cg_info.五行;
                if(e5info){
                    str+=
					'<tr>'+
						'<td style="width:30px;">'+(info[part+'支'+qi_name].天干 || '&nbsp;')+
							'<span class="e5label_'+e5info[0]+'">'+e5info[1]+'</span>'+
						'</td >' +
						'<td style="width:50px">'+
							info.日干命局十神[part_pos_num][k2+1]+
							'('+info[part+'支'+qi_name].命局透出.length+')'+
						'</td>'+
					'</tr>';
                }

            });
            str+='</table>';
            return str;
        }

        $('.c_5_2',winfo_box).html(build_cg_box(word_info,'年'));
        $('.c_5_4',winfo_box).html(build_cg_box(word_info,'月'));
        $('.c_5_6',winfo_box).html(build_cg_box(word_info,'日'));
        $('.c_5_8',winfo_box).html(build_cg_box(word_info,'时'));


        /*大运的信息*/
        function build_st_dayun(rela){
            var re='';
            if(!rela) return '';
            if(rela.冲){
                re+='<div>---相冲---</div>';
            }
            if(rela.合){
                re+='<div>---相合,化'+rela.合+'---</div>';
            }
//                    var diff=rela.五行关系;
//                    if(diff[0]>0){
//                        if(diff[2]){
//                            re+='<div>'+diff[1]+'→</div>';
//                        }else{
//                            re+='<div>←'+diff[1]+'</div>';
//                        }
//                    }
            return re;
        }
        function build_br_dayun(rela){
            var re='';
            if(!rela) return '';
            if(rela.冲){
                re+='<div>---相冲---</div>';
            }
            if(rela.刑){
                re+='<div>---'+rela.刑+'---</div>';
            }
            if(rela.害){
                re+='<div>---相害---</div>';
            }
            if(rela.六合){
                re+='<div>---六合,化'+rela.六合+'---</div>';
            }
            if(rela.半合){
                re+='<div>-半合,缺'+rela.半合[1]+',化'+rela.半合[0]+'-</div>';
            }

//                    var diff=rela.五行关系;
//                    if(diff[0]>0){
//                        if(diff[2]){
//                            re+='<div>'+diff[1]+'→</div>';
//                        }else{
//                            re+='<div>←'+diff[1]+'</div>';
//                        }
//                    }
            return re;
        }

        $('.c_6_1',winfo_box).html('<div>大运干:</div><div>'+(word_info.大运干 || '')+'</div>');
        $('.c_6_2',winfo_box).html(build_st_dayun(word_info.大运年干关系));
        $('.c_6_4',winfo_box).html(build_st_dayun(word_info.大运月干关系));
        $('.c_6_6',winfo_box).html(build_st_dayun(word_info.大运日干关系));
        $('.c_6_8',winfo_box).html(build_st_dayun(word_info.大运时干关系));

        $('.c_7_1',winfo_box).html('<div>大运支:</div><div>'+(word_info.大运支 || '')+'</div>');
        $('.c_7_2',winfo_box).html(build_br_dayun(word_info.大运年支关系));
        $('.c_7_4',winfo_box).html(build_br_dayun(word_info.大运月支关系));
        $('.c_7_6',winfo_box).html(build_br_dayun(word_info.大运日支关系));
        $('.c_7_8',winfo_box).html(build_br_dayun(word_info.大运时支关系));


        //合计信息:
        (function(){
            return '';
            $('.c_8_1',winfo_box).html('合计:');

            //console.log(word_info.统计);
            var _zz_arr={
                '甲':1,
                '乙':1,
                '丙':1,
                '丁':1,
                '戊':1,
                '己':1,
                '庚':1,
                '辛':1,
                '壬':1,
                '癸':1
            };
            function _zz(st){
                if(!_zz_arr[st]) return;
                _zz_arr[st]++;
            }
            $.each(t_arr,function(k,v){
                _zz(word_info[v+'干']);
                _zz((word_info[v+'支本气'] || {}).天干);
                _zz((word_info[v+'支中气'] || {}).天干);
                _zz((word_info[v+'支余气'] || {}).天干);
            });

            var 合计_text='';
            $.each(_zz_arr,function(k,v){
                合计_text+='<div>'+k+':'+(v-1)+'</div>';
            });
            $('.c_8_2',winfo_box).html(合计_text);

            var 合计_text2='';
            $.each(word_info.统计,function(k,v){
                合计_text2+='<div>'+k+':'+v+'</div>';
            });
            $('.c_8_3',winfo_box).html(合计_text2);
        })();

        return word_info;
    }

    $(function(){

        $(window).on('resize',function(){
            $('#display_box,#word_info_box_top').height($(window).height()-1);
        });
        $(window).resize();

        /*初始化手动选择下拉框列表*/
        $(document).on('change','.select_stems',function(){
            var eb_str='';
            var s_info=天干五行[$(this).val()];
            $.each(地支五行,function(k,v){
                if(s_info[0]==v[0]) eb_str+='<option value="'+k+'">'+k+'</option>';
            });
            var sp=$(this).data('target');
            if(!sp){
                sp=$(this).attr('id').split('');
                sp='#'+sp[0]+'支';
            }

            $(sp).html(eb_str);
        });
        var hs_opt_html='';
        for(var i in 天干五行){
            hs_opt_html+='<option value="'+i+'">'+i+'</option>';
        }
        $('.select_stems').each(function(){
            $(this).html(hs_opt_html);
            $(this).change();
        });



        /*初始化天干地支图*/
        var ct=[100,100];
        var r=100;

        $.each(地支五行,function(k,v){
            var ang=(v[2]+2)*Math.PI/6;
            var left  =   ct[0]   +   r   *   Math.cos(ang);
            var top   =   ct[1]   +   r   *   Math.sin(ang);
            var ap=$('<div style="position:absolute;display: inline-block">'+k+'</div>');
            ap.css({'top':top,'left':left});
            $('#branche_box').append(ap);
        });

		layui.use(['table','form','laydate'], function(){
			var laydate = layui.laydate;
			
			
			// $('#input_date').jeDate({
				// format:'YYYY/MM/DD hh:mm:ss',
				// choosefun:function(elem,timestr){
					// reset_8w_time_input(timestr);
				// }
			// });
		
			laydate.render({
				elem: '#input_date',
				type: 'datetime'
			});
			
			
			/*比较开始时间 (第2个)*/
			//$('#start_date').jeDate({
			//    format:'YYYY/MM/DD hh:mm:ss'
			//});
			laydate.render({
				elem: '#start_date',
				type: 'datetime'
			});

		});
			
		
       
        $('#reset_today').click(function(){
            move_date(0);
        });

        /*快速查看前后信息*/
        $('#prev_word_d').click(function(){
            move_date(12);
        });
        $('#next_word_d').click(function(){
            move_date(-12);
        });
        $('#prev_word_t').click(function(){
            move_date(1);
        });
        $('#next_word_t').click(function(){
            move_date(-1);
        });
		
		/*是否显示简要信息*/
		$('#calc_simple_info').change(function(){
            var calc_simple_info=$(this).is(':checked');
			if(calc_simple_info){
				$('#word_info_box_top').addClass('simple_info');
			}else{
				$('#word_info_box_top').removeClass('simple_info');
			}
        });

      
			
			

        /*翻页*/
        $(document).on('click','.next_btn',function(){
			console.log(1111,$(this).closest('.box_block'));
            $(this).closest('.box_block').hide().next().show();
            myChart.resize();
        });
        $('.prev_btn').click(function(){
            $(this).closest('.box_block').hide().prev().show();
        });

		
        /*开始计算输入的日期*/
        $('#calc_now').click(function(){
            updateHashTag();
            var show_5e=$('#show_5e').is(':checked');
            update_calc_param();
            reload_word_info_table('word_info_box1');
			var date=$('#input_date').val();

        });

		/*计算 所选时间段内的情况*/
        $('#calc_next').click(function(){
            update_calc_param();

            var start_str=$('#start_date').val();
            if(!start_str){
                var tmp=new Date();
                tmp=tmp.getTime()-0;
                tmp=sb_calc_tools.get_date_split_arr(tmp);
                start_str=tmp[5];
                $('#start_date').val(start_str);
            }

            var start=start_str.split(' ');
            var delimiter_year='-';
            start[0]=start[0].split(delimiter_year);
            start[1]=start[1].split(':');
            if(start[1][0]%2==1){ /*如果小时是奇数,则算做是下一个小时的时辰*/
                start[1][0]-=-1;/*小时数 +1 作为计算时间点*/
            }
            var start_year=start[0][0];

            /*TODO::处理精确到分的节气分界点*/
            start=new Date(start[0][0]+'/'+start[0][1]+'/'+start[0][2]+' '+start[1][0]+':00:00');
            start=start.getTime();

            var calc_next_length=$('#calc_next_length').val();
            var end_time=start+calc_next_length*24*3600*1000;

			
            var word_info_list={};
            var _task={
                finish:function(num){
                    delete _task.pool[num];
                    for(var x in _task.pool){
                        /*遍历任务池,如果还存在任务,则中断*/
                        return;
                        /*只有当任务池中没有数据时才会继续*/
                    }
                    sb_calc_tools.get_lunar_month_data(start_year,function(err,lunar_month){
                        if(err){
                            return;
                        }
                        _task.end(lunar_month);
                    });
                },
                end:function(lunar_month){

                },
                pool:{

                }
            };


            var org_word_info={};
            if(calc_param.compare_by_input){
                org_word_info=reload_word_info_table('word_info_box1');
            }

			var calc_length=$('#calc_length').val();

			var time_step=2*3600*1000;
			switch(calc_length){
				case 'h':
                    time_step=2*3600*1000;
					break;
				case 'd':
					time_step=24*3600*1000;
					break;
			}


            for(var s=start;s<end_time;s+=time_step){
                _task.pool[s]=1;
                word_info_list[s]={};
            }
            var count=0;
			$('#word_info_box_top').html('');
            for(var x in word_info_list){
                (function(input_date){
                    sb_calc_tools.get_date_8w_info(parseInt(input_date),function(err,date_word,date_arr){
                        if(err) return ;
                        count++;
                        var winfo=reload_word_info_table('word_info_box'+count,org_word_info,date_word,date_arr[5]);
						
                        //console.log(input_date,date_word);
//                        var winfo=sb_calc_tools.parse_all(org_word_info,date_word,calc_param);
//                        console.log(5555,winfo);

                        word_info_list[input_date]=winfo;

                        _task.finish(input_date);
                    });
                })(x);
            }

        });
    });



</script>

</html>
